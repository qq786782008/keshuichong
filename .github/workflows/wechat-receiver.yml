name: WeChat Message Receiver

on:
  schedule:
    - cron: '*/5 * * * *'  # æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  repository_dispatch:  # å¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨
    types: [wechat-message]

jobs:
  receive-wechat-message:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'repository_dispatch'
    
    steps:
      - name: Log WeChat Message
        run: |
          echo "ğŸ“± æ”¶åˆ°ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯"
          echo "â° æ—¶é—´: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ“ å†…å®¹: ${{ github.event.inputs.message || 'No message provided' }}"
          
          # è¿™é‡Œå¯ä»¥æ·»åŠ å¤„ç†é€»è¾‘
          # 1. è§£ææ¶ˆæ¯å†…å®¹
          # 2. è°ƒç”¨OpenClaw API
          # 3. å›å¤åˆ°ä¼ä¸šå¾®ä¿¡
          
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Send Reply via OpenClaw
        run: |
          # å¦‚æœéœ€è¦å›å¤åˆ°ä¼ä¸šå¾®ä¿¡
          echo "ğŸ¤– æ­£åœ¨å›å¤åˆ°ä¼ä¸šå¾®ä¿¡..."
          
          # è¿™é‡Œå¯ä»¥æ·»åŠ å‘é€é€»è¾‘
          # 1. è°ƒç”¨ä¼ä¸šå¾®ä¿¡API
          # 2. å‘é€å›å¤æ¶ˆæ¯
          
        env:
          WECHAT_WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}

  periodic-check:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    
    steps:
      - name: System Health Check
        run: |
          echo "ğŸ” ä¼ä¸šå¾®ä¿¡é›†æˆçŠ¶æ€æ£€æŸ¥"
          echo "â° æ£€æŸ¥æ—¶é—´: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          echo "âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸"
          
      - name: Test Webhook
        run: |
          echo "ğŸ§ª æµ‹è¯•ä¼ä¸šå¾®ä¿¡è¿æ¥..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ è¿æ¥æµ‹è¯•é€»è¾‘